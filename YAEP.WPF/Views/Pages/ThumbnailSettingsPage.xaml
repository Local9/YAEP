<Page
    x:Class="YAEP.Views.Pages.ThumbnailSettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:enums="clr-namespace:YAEP"
    xmlns:helpers="clr-namespace:YAEP.Helpers"
    xmlns:local="clr-namespace:YAEP.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="ThumbnailSettingsPage"
    d:DataContext="{d:DesignInstance local:ThumbnailSettingsPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    DataContext="{Binding RelativeSource={RelativeSource Self}}"
    mc:Ignorable="d">
    <Page.Resources>
        <helpers:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <helpers:InverseNullToVisibilityConverter x:Key="InverseNullToVisibilityConverter" />
        <helpers:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        <helpers:StringToBrushConverter x:Key="StringToBrushConverter" />
        <helpers:WindowRatioDisplayConverter x:Key="WindowRatioDisplayConverter" />
        <helpers:WindowRatioToBooleanConverter x:Key="WindowRatioToBooleanConverter" />
        <ObjectDataProvider x:Key="WindowRatioEnum" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="enums:WindowRatio" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Page.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="16">
            <TextBlock
                FontSize="20"
                FontWeight="Medium"
                Text="Thumbnail Settings" />
            <TextBlock
                Margin="0,8,0,0"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                Text="Configure default thumbnail settings and manage window-specific thumbnail configurations." />
            
            <TextBlock
                Margin="0,24,0,0"
                FontSize="16"
                FontWeight="Medium"
                Text="Default Settings" />
            <Border
                Margin="0,8,0,0"
                Padding="12"
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Visibility="{Binding ViewModel.DefaultThumbnailConfig, Converter={StaticResource NullToVisibilityConverter}}">
                <StackPanel>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Ratio:" />
                        <ComboBox
                            Grid.Row="0"
                            Grid.Column="1"
                            Grid.ColumnSpan="2"
                            Margin="0,0,0,12"
                            ItemsSource="{Binding Source={StaticResource WindowRatioEnum}}"
                            SelectedItem="{Binding ViewModel.DefaultRatio, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={StaticResource WindowRatioDisplayConverter}}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        
                        <TextBlock Grid.Row="1" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Width:" />
                        <Slider
                            Grid.Row="1"
                            Grid.Column="1"
                            Margin="0,0,8,12"
                            Minimum="192"
                            Maximum="960"
                            TickFrequency="1"
                            IsSnapToTickEnabled="True"
                            Value="{Binding ViewModel.DefaultWidth, Mode=TwoWay}" />
                        <TextBlock Grid.Row="1" Grid.Column="2" Margin="0,0,0,12" VerticalAlignment="Center" MinWidth="50" TextAlignment="Right" Text="{Binding ViewModel.DefaultWidth, Mode=OneWay}" />
                        
                        <TextBlock Grid.Row="2" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Height:" />
                        <Slider
                            Grid.Row="2"
                            Grid.Column="1"
                            Margin="0,0,8,12"
                            Minimum="108"
                            Maximum="540"
                            TickFrequency="1"
                            IsSnapToTickEnabled="True"
                            IsEnabled="{Binding ViewModel.DefaultRatio, Converter={StaticResource WindowRatioToBooleanConverter}, ConverterParameter=Inverse}"
                            Value="{Binding ViewModel.DefaultHeight, Mode=TwoWay}" />
                        <ui:TextBox
                            Grid.Row="2"
                            Grid.Column="2"
                            Margin="0,0,0,12"
                            MinWidth="50"
                            MaxWidth="80"
                            TextAlignment="Right"
                            IsReadOnly="{Binding ViewModel.DefaultRatio, Converter={StaticResource WindowRatioToBooleanConverter}}"
                            Text="{Binding ViewModel.DefaultHeight, Mode=OneWay}" />
                        
                        <TextBlock Grid.Row="3" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Opacity:" />
                        <Slider
                            Grid.Row="3"
                            Grid.Column="1"
                            Margin="0,0,8,12"
                            Minimum="0"
                            Maximum="1"
                            TickFrequency="0.01"
                            IsSnapToTickEnabled="True"
                            Value="{Binding ViewModel.DefaultOpacity, Mode=TwoWay}" />
                        <TextBlock Grid.Row="3" Grid.Column="2" Margin="0,0,0,12" VerticalAlignment="Center" MinWidth="50" TextAlignment="Right" Text="{Binding ViewModel.DefaultOpacity, StringFormat='{}{0:P0}', Mode=OneWay}" />
                        
                        <TextBlock Grid.Row="4" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Focus Border Color:" />
                        <Button
                            Grid.Row="4"
                            Grid.Column="1"
                            Grid.ColumnSpan="2"
                            Margin="0,0,0,12"
                            HorizontalAlignment="Left"
                            Command="{Binding ViewModel.PickFocusBorderColorCommand, Mode=OneWay}"
                            Padding="8,4">
                            <StackPanel Orientation="Horizontal">
                                <Border
                                    Width="24"
                                    Height="24"
                                    Margin="0,0,8,0"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    Background="{Binding ViewModel.DefaultFocusBorderColor, Converter={StaticResource StringToBrushConverter}}" />
                                <TextBlock
                                    VerticalAlignment="Center"
                                    Text="{Binding ViewModel.DefaultFocusBorderColor, Mode=OneWay}" />
                            </StackPanel>
                        </Button>
                        
                        <TextBlock Grid.Row="5" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Focus Border Thickness:" />
                        <Slider
                            Grid.Row="5"
                            Grid.Column="1"
                            Margin="0,0,8,12"
                            Minimum="1"
                            Maximum="10"
                            TickFrequency="1"
                            IsSnapToTickEnabled="True"
                            Value="{Binding ViewModel.DefaultFocusBorderThickness, Mode=TwoWay}" />
                        <TextBlock Grid.Row="5" Grid.Column="2" Margin="0,0,0,12" VerticalAlignment="Center" MinWidth="50" TextAlignment="Right" Text="{Binding ViewModel.DefaultFocusBorderThickness, Mode=OneWay}" />
                        
                        <TextBlock Grid.Row="6" Grid.Column="0" Margin="0,0,8,0" VerticalAlignment="Center" Text="Show Title Overlay:" />
                        <ui:ToggleSwitch
                            Grid.Row="6"
                            Grid.Column="1"
                            Grid.ColumnSpan="2"
                            HorizontalAlignment="Left"
                            IsChecked="{Binding ViewModel.DefaultShowTitleOverlay, Mode=TwoWay}" />
                    </Grid>
                </StackPanel>
            </Border>
            <TextBlock
                Margin="0,8,0,0"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                Text="No default settings available. Please select an active profile."
                Visibility="{Binding ViewModel.DefaultThumbnailConfig, Converter={StaticResource InverseNullToVisibilityConverter}}" />

            <StackPanel Orientation="Horizontal">
                <TextBlock
                    Margin="0,24,0,0"
                    FontSize="16"
                    FontWeight="Medium"
                    Text="Window-Specific Settings" />
                <ui:Button
                    Margin="12,24,0,0"
                    Command="{Binding ViewModel.UpdateAllThumbnailsWithDefaultCommand, Mode=OneWay}"
                    Content="Update All with Default"
                    Visibility="{Binding ViewModel.ThumbnailSettings.Count, Converter={StaticResource CountToVisibilityConverter}}" />
            </StackPanel>
            <DataGrid
                Margin="0,8,0,0"
                AutoGenerateColumns="False"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                IsReadOnly="True"
                ItemsSource="{Binding ViewModel.ThumbnailSettings, Mode=OneWay}">
                <DataGrid.Columns>
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding WindowTitle, Mode=OneWay}"
                        Header="Window Title" />
                    <DataGridTextColumn
                        Width="80"
                        Binding="{Binding Config.Width, Mode=OneWay}"
                        Header="Width" />
                    <DataGridTextColumn
                        Width="80"
                        Binding="{Binding Config.Height, Mode=OneWay}"
                        Header="Height" />
                    <DataGridTextColumn
                        Width="80"
                        Binding="{Binding Config.Opacity, StringFormat='{}{0:P0}', Mode=OneWay}"
                        Header="Opacity" />
                    <DataGridTemplateColumn Width="Auto" Header="Actions">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <ui:Button
                                        Margin="0,0,8,0"
                                        Command="{Binding DataContext.ViewModel.EditThumbnailSettingCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                        CommandParameter="{Binding}"
                                        Content="Edit" />
                                    <ui:Button
                                        Appearance="Danger"
                                        Command="{Binding DataContext.ViewModel.DeleteThumbnailSettingCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                        CommandParameter="{Binding}"
                                        Content="Delete" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
            
            <TextBlock
                Margin="0,16,0,0"
                FontSize="12"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                Text="No window-specific settings configured"
                Visibility="{Binding ViewModel.ThumbnailSettings.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Inverse}" />
        </StackPanel>
    </ScrollViewer>
</Page>

