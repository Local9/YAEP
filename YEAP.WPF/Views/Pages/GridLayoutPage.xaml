<Page
    x:Class="YAEP.Views.Pages.GridLayoutPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:enums="clr-namespace:YAEP"
    xmlns:helpers="clr-namespace:YAEP.Helpers"
    xmlns:local="clr-namespace:YAEP.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="GridLayoutPage"
    d:DataContext="{d:DesignInstance local:GridLayoutPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    DataContext="{Binding RelativeSource={RelativeSource Self}}"
    mc:Ignorable="d">
    <Page.Resources>
        <helpers:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <helpers:WindowRatioDisplayConverter x:Key="WindowRatioDisplayConverter" />
        <helpers:WindowRatioToBooleanConverter x:Key="WindowRatioToBooleanConverter" />
        <ObjectDataProvider x:Key="WindowRatioEnum" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="enums:WindowRatio" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Page.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="16">
            <TextBlock
                FontSize="20"
                FontWeight="Medium"
                Text="Grid Layout" />
            <TextBlock
                Margin="0,8,0,0"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                Text="Arrange thumbnails in a grid layout. Configure the grid cell size, starting position, and ordering, then apply to update all thumbnail settings." />

            <TextBlock
                Margin="0,24,0,0"
                FontSize="16"
                FontWeight="Medium"
                Text="Grid Configuration" />
            
            <Border
                Margin="0,8,0,0"
                Padding="12"
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="4">
                <StackPanel>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Use Thumbnail:" />
                        <ComboBox
                            Grid.Row="0"
                            Grid.Column="1"
                            Grid.ColumnSpan="2"
                            Margin="0,0,0,12"
                            ItemsSource="{Binding ViewModel.ThumbnailSettings, Mode=OneWay}"
                            SelectedItem="{Binding ViewModel.SelectedThumbnailForStartPosition, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock>
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="{}{0} - Pos: ({1}, {2}) Size: {3}x{4}">
                                                <Binding Path="WindowTitle" />
                                                <Binding Path="Config.X" />
                                                <Binding Path="Config.Y" />
                                                <Binding Path="Config.Width" />
                                                <Binding Path="Config.Height" />
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                        <TextBlock Grid.Row="1" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Cell Ratio:" />
                        <ComboBox
                            Grid.Row="1"
                            Grid.Column="1"
                            Grid.ColumnSpan="2"
                            Margin="0,0,0,12"
                            ItemsSource="{Binding Source={StaticResource WindowRatioEnum}}"
                            SelectedItem="{Binding ViewModel.GridCellRatio, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={StaticResource WindowRatioDisplayConverter}}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                        <TextBlock Grid.Row="2" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Cell Width:" />
                        <Slider
                            Grid.Row="2"
                            Grid.Column="1"
                            Margin="0,0,8,12"
                            Minimum="192"
                            Maximum="960"
                            TickFrequency="1"
                            IsSnapToTickEnabled="True"
                            Value="{Binding ViewModel.GridCellWidth, Mode=TwoWay}" />
                        <ui:TextBox
                            Grid.Row="2"
                            Grid.Column="2"
                            Margin="0,0,0,12"
                            MinWidth="60"
                            MaxWidth="80"
                            TextAlignment="Right"
                            Text="{Binding ViewModel.GridCellWidthText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        
                        <TextBlock Grid.Row="3" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Cell Height:" />
                        <Slider
                            Grid.Row="3"
                            Grid.Column="1"
                            Margin="0,0,8,12"
                            Minimum="108"
                            Maximum="540"
                            TickFrequency="1"
                            IsSnapToTickEnabled="True"
                            IsEnabled="{Binding ViewModel.GridCellRatio, Converter={StaticResource WindowRatioToBooleanConverter}, ConverterParameter=Inverse}"
                            Value="{Binding ViewModel.GridCellHeight, Mode=TwoWay}" />
                        <ui:TextBox
                            Grid.Row="3"
                            Grid.Column="2"
                            Margin="0,0,0,12"
                            MinWidth="60"
                            MaxWidth="80"
                            TextAlignment="Right"
                            IsReadOnly="{Binding ViewModel.GridCellRatio, Converter={StaticResource WindowRatioToBooleanConverter}}"
                            Text="{Binding ViewModel.GridCellHeightText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        
                        
                        
                        <TextBlock Grid.Row="4" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Start X:" />
                        <Slider
                            Grid.Row="4"
                            Grid.Column="1"
                            Margin="0,0,8,12"
                            Minimum="-10000"
                            Maximum="31000"
                            TickFrequency="100"
                            IsSnapToTickEnabled="True"
                            Value="{Binding ViewModel.GridStartX, Mode=TwoWay}" />
                        <ui:TextBox
                            Grid.Row="4"
                            Grid.Column="2"
                            Margin="0,0,0,12"
                            MinWidth="60"
                            MaxWidth="80"
                            TextAlignment="Right"
                            Text="{Binding ViewModel.GridStartXText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        
                        <TextBlock Grid.Row="5" Grid.Column="0" Margin="0,0,8,12" VerticalAlignment="Center" Text="Start Y:" />
                        <Slider
                            Grid.Row="5"
                            Grid.Column="1"
                            Margin="0,0,8,12"
                            Minimum="-10000"
                            Maximum="31000"
                            TickFrequency="100"
                            IsSnapToTickEnabled="True"
                            Value="{Binding ViewModel.GridStartY, Mode=TwoWay}" />
                        <ui:TextBox
                            Grid.Row="5"
                            Grid.Column="2"
                            Margin="0,0,0,12"
                            MinWidth="60"
                            MaxWidth="80"
                            TextAlignment="Right"
                            Text="{Binding ViewModel.GridStartYText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        
                        <TextBlock Grid.Row="6" Grid.Column="0" Margin="0,0,8,0" VerticalAlignment="Center" Text="Columns:" />
                        <Slider
                            Grid.Row="6"
                            Grid.Column="1"
                            Margin="0,0,8,0"
                            Minimum="1"
                            Maximum="10"
                            TickFrequency="1"
                            IsSnapToTickEnabled="True"
                            Value="{Binding ViewModel.GridColumns, Mode=TwoWay}" />
                        <ui:TextBox
                            Grid.Row="6"
                            Grid.Column="2"
                            MinWidth="60"
                            MaxWidth="80"
                            TextAlignment="Right"
                            Text="{Binding ViewModel.GridColumnsText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    </Grid>
                </StackPanel>
            </Border>

            <StackPanel
                Margin="0,16,0,0"
                Orientation="Horizontal">
                <ui:Button
                    Command="{Binding ViewModel.ApplyGridLayoutCommand, Mode=OneWay}"
                    Content="Apply Grid Layout"
                    Visibility="{Binding ViewModel.GridPreview.Count, Converter={StaticResource CountToVisibilityConverter}}" />
            </StackPanel>

            <TextBlock
                Margin="0,24,0,0"
                FontSize="16"
                FontWeight="Medium"
                Text="Grid Preview" />
            <TextBlock
                Margin="0,8,0,0"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                Text="Preview of how thumbnails will be arranged in the grid layout." />
            
            <DataGrid
                x:Name="GridPreviewDataGrid"
                Margin="0,8,0,0"
                AutoGenerateColumns="False"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                IsReadOnly="True"
                SelectionMode="Single"
                ItemsSource="{Binding ViewModel.GridPreview, Mode=OneWay}">
                <DataGrid.Columns>
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding WindowTitle, Mode=OneWay}"
                        Header="Window Title" />
                    <DataGridTextColumn
                        Width="60"
                        Binding="{Binding Row, Mode=OneWay}"
                        Header="Row" />
                    <DataGridTextColumn
                        Width="60"
                        Binding="{Binding Column, Mode=OneWay}"
                        Header="Column" />
                    <DataGridTextColumn
                        Width="100"
                        Binding="{Binding NewX, Mode=OneWay}"
                        Header="New X" />
                    <DataGridTextColumn
                        Width="100"
                        Binding="{Binding NewY, Mode=OneWay}"
                        Header="New Y" />
                    <DataGridTextColumn
                        Width="100"
                        Binding="{Binding NewWidth, Mode=OneWay}"
                        Header="New Width" />
                    <DataGridTextColumn
                        Width="100"
                        Binding="{Binding NewHeight, Mode=OneWay}"
                        Header="New Height" />
                </DataGrid.Columns>
            </DataGrid>
            
            <TextBlock
                Margin="0,16,0,0"
                FontSize="12"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                Text="No thumbnails available. Create thumbnail settings in the Settings page first."
                Visibility="{Binding ViewModel.GridPreview.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=Inverse}" />
        </StackPanel>
    </ScrollViewer>
</Page>

